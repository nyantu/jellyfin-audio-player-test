workflows:
  fintunes-test:
    name: Fintunes Test Build
    instance_type: mac_mini_m1
    max_build_duration: 60
    environment:
      flutter: stable
      node: latest
      cocoapods: default
    scripts:
      - name: Install dependencies
        script: |
          cd $CM_PROJECT_DIR
          # Remove immutable setting temporarily and install
          yarn config set enableImmutableInstalls false
          yarn install
          # Install React Native CLI globally
          npm install -g @react-native-community/cli
      - name: Install iOS dependencies
        script: |
          cd $CM_PROJECT_DIR/ios
          pod install
      - name: Build iOS
        script: |
          cd $CM_PROJECT_DIR
          # Use the React Native CLI directly
          npx react-native run-ios --configuration Release --device
    artifacts:
      - ios/build/Build/Products/Release-iphoneos/*.ipa
      - ios/build/Build/Products/Release-iphoneos/*.app
